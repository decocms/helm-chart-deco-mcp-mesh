# Default values for chart-deco-mcp-mesh.
# O valor abaixo só é considerado se o autoscalling estiver desabilitado.
replicaCount: 1

strategy:
  # type: ""  # Deixe vazio para auto-detecção:
  #   - RollingUpdate: se database.engine=postgresql OU persistence.distributed=true OU accessMode=ReadWriteMany
  #   - Recreate: se SQLite com ReadWriteOnce (padrão)
  # rollingUpdate:
  #   maxSurge: 1
  #   maxUnavailable: 0

image:
  repository: ghcr.io/decocms/admin/mesh
  pullPolicy: Always

service:
  type: ClusterIP
  port: 80
  targetPort: 3000

resources:
  requests:
    memory: "300Mi"
    cpu: "250m"
  limits:
    memory: "600Mi"
    cpu: "500m"

database:
  engine: sqlite # sqlite | postgresql
  url: ""        # Obrigatório quando engine=postgresql
  caCert: ""     # Opcional: Espeifique o certificado CA existente em formato PEM

persistence:
  enabled: true
  accessMode: ReadWriteOnce
  storageClass: "gp3"  # string vazia aplica a default storage class.
  size: 10Gi
  claimName: ""  # Opcional: Espeifique o nome do PVC existente
  distributed: false  # Marque como true se o storage oferecer ReadWriteMany

autoscaling:
  enabled: false
  minReplicas: 3
  maxReplicas: 6
  #targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

configMap:
  meshConfig:
    NODE_ENV: "production"
    PORT: "3000"
    HOST: "0.0.0.0"
    BETTER_AUTH_URL: "https://mesh.example.com"
    BASE_URL: "https://mesh.example.com"
  
  authConfig:
    emailAndPassword:
      enabled: true


secret:
  # secretName: ""  # Se definido, usa este secret existente (não cria novo secret)
  # Gere a secret com o comando a seguir: openssl rand -base64 32
  BETTER_AUTH_SECRET: "defina_sua_secret_com_o_comando_acima"

volumes: []
# - name: foo
#   secret:
#     secretName: mysecret
#     optional: false

extraContainers: []
# - name: cloudsql-proxy
#   image: gcr.io/cloudsql-docker/gce-proxy:1.33.1
#   args:
#     - "/cloud_sql_proxy"
#     - "-instances=PROJECT:REGION:INSTANCE=tcp:5432"

volumeMounts: []
# - name: foo
#   mountPath: "/etc/foo"
#   readOnly: true

podSecurityContext:
  fsGroup: 1001
  fsGroupChangePolicy: "OnRootMismatch"

securityContext:
  runAsNonRoot: true
  runAsUser: 1001
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false

livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
readinessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 4

nodeSelector:
  kubernetes.io/arch: amd64

tolerations: []
# Exemplo:
# tolerations:
#   - key: "env"
#     operator: "Equal"
#     value: "dev"
#     effect: "NoSchedule"

affinity: {}
# Exemplo:
# affinity:
#   podAntiAffinity:
#     preferredDuringSchedulingIgnoredDuringExecution:
#       - weight: 100
#         podAffinityTerm:
#           labelSelector:
#             matchLabels:
#               app.kubernetes.io/name: chart-deco-mcp-mesh
#           topologyKey: kubernetes.io/hostname

# Topology Spread Constraints (opcional - deixe vazio [] para desabilitar)
#topologySpreadConstraints: []
topologySpreadConstraints:
  - maxSkew: 1
    topologyKey: topology.kubernetes.io/zone
    whenUnsatisfiable: ScheduleAnyway
    labelSelector:
      matchLabels:
        app.kubernetes.io/name: chart-deco-mcp-mesh
        app.kubernetes.io/instance: deco-mcp-mesh
